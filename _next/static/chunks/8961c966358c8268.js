(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,42920,e=>{"use strict";let a=(0,e.i(75254).default)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]);e.s(["Building",()=>a],42920)},89954,e=>{"use strict";var a=e.i(43476),r=e.i(71645),t=e.i(18566),s=e.i(42920),n=e.i(75254);let l=(0,n.default)("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]),i=(0,n.default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),o=(0,n.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var d=e.i(17927);function u(){let e=(0,t.useRouter)(),[n,u]=(0,r.useState)("login"),[m,c]=(0,r.useState)([]),[g,p]=(0,r.useState)([]),[b,h]=(0,r.useState)({street:"",building:"",apartment_no:"",password:"",name:"",family_size:"3",email:""}),[x,y]=(0,r.useState)(!1),[f,k]=(0,r.useState)(""),[j,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{w()},[]);let w=async()=>{try{console.log("VeritabanÄ± baÄŸlantÄ±sÄ± deneniyor...");let{data:e,error:a}=await d.supabase.from("streets").select("id, name, city, district").order("name");if(a)throw console.error("Sokaklar Ã§ekilirken hata:",a),a;if(e&&e.length>0){let a=e.map(e=>e.name);console.log("Ã‡ekilen sokaklar:",a),c(a);let r=new Map;e.forEach(e=>r.set(e.id,e.name));let{data:t,error:s}=await d.supabase.from("buildings").select("id, name, street_id, total_floors, total_apartments").order("name");if(s)throw console.error("Binalar Ã§ekilirken hata:",s),s;if(t&&t.length>0){let e=t.map(e=>({id:e.id.toString(),name:e.name,street:r.get(e.street_id)||"Bilinmeyen Sokak",floors:e.total_floors||5,apartments:Array.from({length:e.total_apartments||10},(e,a)=>(a+1).toString())}));console.log("Ã‡ekilen binalar:",e.length),p(e)}}}catch(e){console.error("VeritabanÄ± baÄŸlantÄ± hatasÄ±:",e),c(["GÃ¼l SokaÄŸÄ±","Ã‡iÃ§ek Sokak","BahÃ§e Sokak"]),p([{id:"1",name:"YeÅŸil ApartmanÄ±",street:"GÃ¼l SokaÄŸÄ±",floors:5,apartments:["1","2","3","4","5","6","7","8","9","10"]}])}},N=b.street?g.filter(e=>e.street===b.street):[],_=g.find(e=>e.name===b.building),S=_?.apartments||[],A=async()=>{"login"===n?await B():await I()},B=async()=>{if(!b.street||!b.building||!b.apartment_no||!b.password)return void k("LÃ¼tfen tÃ¼m alanlarÄ± doldurun");y(!0),k("");try{console.log("=== LOGIN BAÅLIYOR ===");let{data:a,error:r}=await d.supabase.from("buildings").select(`
        id,
        name,
        street_id,
        streets!inner(id, name)
      `).eq("name",b.building).eq("streets.name",b.street).single();if(r||!a){console.error("Bina bulunamadÄ±:",r),k("Bu apartman bulunamadÄ±"),y(!1);return}console.log("âœ“ Bina bulundu:",a.id);let{data:t,error:s}=await d.supabase.from("apartments").select("id, number, building_id").eq("building_id",a.id).eq("number",b.apartment_no).single();if(s||!t){console.error("Daire bulunamadÄ±:",s),k("Bu daire bulunamadÄ±"),y(!1);return}console.log("âœ“ Daire bulundu:",t.id);let{data:n,error:l}=await d.supabase.from("users").select("*").eq("apartment_id",t.id).eq("password",b.password).single();if(l||!n){console.error("KullanÄ±cÄ± bulunamadÄ±:",l),k("Åifre hatalÄ± veya kullanÄ±cÄ± bulunamadÄ±"),y(!1);return}console.log("âœ“ KullanÄ±cÄ± bulundu:",n.name);let i=Array.isArray(a.streets)?a.streets[0]:a.streets,o={...n,apartment:{id:t.id,number:t.number,building:{id:a.id,name:a.name,street:{id:i?.id||0,name:i?.name||b.street}}}};localStorage.setItem("ekoakort_user",JSON.stringify(o)),await d.supabase.from("users").update({last_login:new Date().toISOString()}).eq("id",n.id),console.log("=== LOGIN BAÅARIYLA TAMAMLANDI ==="),e.push("/dashboard")}catch(e){console.error("LOGIN CATCH HATASI:",e),k("GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu")}finally{y(!1)}},I=async()=>{if(!b.street||!b.building||!b.apartment_no||!b.password)return void k("LÃ¼tfen tÃ¼m alanlarÄ± doldurun");if(b.password.length<6)return void k("Åifre en az 6 karakter olmalÄ±dÄ±r");y(!0),k("");let a=null;try{console.log("=== REGISTER BAÅLIYOR ===");let{data:r,error:t}=await d.supabase.from("buildings").select(`
        id,
        name,
        street_id,
        streets!inner(id, name)
      `).eq("name",b.building).eq("streets.name",b.street).single();if(t||!r){console.error("Bina bulunamadÄ±:",t),k("Bu apartman bulunamadÄ±"),y(!1);return}console.log("âœ“ Bina bulundu:",r.id);let{data:s,error:n}=await d.supabase.from("apartments").select("id, number, building_id").eq("building_id",r.id).eq("number",b.apartment_no).single();if(n){console.log("Daire bulunamadÄ±, oluÅŸturuluyor...");let{data:e,error:t}=await d.supabase.from("apartments").insert([{building_id:r.id,number:b.apartment_no,floor:1,area_sqm:100}]).select().single();if(t){console.error("Daire oluÅŸturma hatasÄ±:",t),k("Daire oluÅŸturulamadÄ±"),y(!1);return}a=e,console.log("âœ“ Yeni daire oluÅŸturuldu:",a.id)}else{a=s,console.log("âœ“ Mevcut daire bulundu:",a.id);let{data:e}=await d.supabase.from("users").select("id, name").eq("apartment_id",a.id).maybeSingle();if(e){console.log("âœ— Daire dolu! Mevcut kullanÄ±cÄ±:",e),k(`Bu daire zaten kayÄ±tlÄ± (${e.name})`),y(!1);return}}console.log("âœ“ Daire boÅŸ, kayÄ±t yapÄ±labilir");let l={apartment_id:a.id,password:b.password,name:b.name||`Daire ${b.apartment_no} Sakini`,family_size:parseInt(b.family_size)||3,email:b.email||null,total_points:0,current_streak:1,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("GÃ¶nderilecek user data:",l);let{data:i,error:o}=await d.supabase.from("users").insert([l]).select().single();if(o){console.error("KullanÄ±cÄ± ekleme hatasÄ±:",o),k(`KayÄ±t hatasÄ±: ${o.message}`),y(!1);return}console.log("âœ“ KullanÄ±cÄ± baÅŸarÄ±yla oluÅŸturuldu:",i.id);let u=Array.isArray(r.streets)?r.streets[0]:r.streets,m={...i,apartment:{id:a.id,number:a.number,building:{id:r.id,name:r.name,street:{id:u?.id||0,name:u?.name||b.street}}}};localStorage.setItem("ekoakort_user",JSON.stringify(m)),console.log("âœ“ LocalStorage'a kaydedildi"),console.log("=== REGISTER BAÅARIYLA TAMAMLANDI ==="),setTimeout(()=>{e.push("/dashboard")},500)}catch(e){console.error("REGISTER CATCH HATASI:",e),k("Beklenmeyen bir hata: "+(e.message||"Bilinmeyen hata"))}finally{y(!1)}},M=()=>{h({street:"",building:"",apartment_no:"",password:"",name:"",family_size:"3",email:""}),k("")};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-blue-50 py-12 px-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(s.Building,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Eko-Akort"}),(0,a.jsx)("p",{className:"text-gray-600",children:"AkÄ±llÄ± Tasarruf Platformu"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[(0,a.jsxs)("div",{className:"flex mb-6 bg-gray-100 p-1 rounded-lg",children:[(0,a.jsxs)("button",{onClick:()=>{u("login"),M()},className:`flex-1 py-2 rounded-md text-center font-medium transition ${"login"===n?"bg-white shadow":"text-gray-600"}`,children:[(0,a.jsx)(l,{className:"w-4 h-4 inline mr-2"}),"GiriÅŸ Yap"]}),(0,a.jsxs)("button",{onClick:()=>{u("register"),M()},className:`flex-1 py-2 rounded-md text-center font-medium transition ${"register"===n?"bg-white shadow":"text-gray-600"}`,children:[(0,a.jsx)(i,{className:"w-4 h-4 inline mr-2"}),"KayÄ±t Ol"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sokak *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:b.street,onChange:e=>h({...b,street:e.target.value,building:"",apartment_no:""}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent appearance-none pr-10",children:[(0,a.jsx)("option",{value:"",children:"Sokak seÃ§in"}),m.map((e,r)=>(0,a.jsx)("option",{value:e,children:e},r))]}),(0,a.jsx)(o,{className:"absolute right-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apartman *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:b.building,onChange:e=>h({...b,building:e.target.value,apartment_no:""}),disabled:!b.street,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent appearance-none pr-10 ${!b.street?"bg-gray-50 text-gray-400":"border-gray-300"}`,children:[(0,a.jsx)("option",{value:"",children:"Apartman seÃ§in"}),N.map(e=>(0,a.jsxs)("option",{value:e.name,children:[e.name," (",e.floors," kat)"]},e.id))]}),(0,a.jsx)(o,{className:"absolute right-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Daire No *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:b.apartment_no,onChange:e=>h({...b,apartment_no:e.target.value}),disabled:!b.building,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent appearance-none pr-10 ${!b.building?"bg-gray-50 text-gray-400":"border-gray-300"}`,children:[(0,a.jsx)("option",{value:"",children:"Daire seÃ§in"}),S.map(e=>(0,a.jsxs)("option",{value:e,children:["Daire ",e]},e))]}),(0,a.jsx)(o,{className:"absolute right-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Åifre *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:j?"text":"password",value:b.password,onChange:e=>h({...b,password:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent pr-10",placeholder:"login"===n?"Åifrenizi girin":"En az 6 karakter",minLength:6}),(0,a.jsx)("button",{type:"button",onClick:()=>v(!j),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:j?"ğŸ™ˆ":"ğŸ‘ï¸"})]})]}),"register"===n&&(0,a.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AdÄ±nÄ±z (Ä°steÄŸe BaÄŸlÄ±)"}),(0,a.jsx)("input",{type:"text",value:b.name,onChange:e=>h({...b,name:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"AdÄ±nÄ±z"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"KiÅŸi SayÄ±sÄ± *"}),(0,a.jsxs)("select",{value:b.family_size,onChange:e=>h({...b,family_size:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"1",children:"1 KiÅŸi"}),(0,a.jsx)("option",{value:"2",children:"2 KiÅŸi"}),(0,a.jsx)("option",{value:"3",children:"3 KiÅŸi"}),(0,a.jsx)("option",{value:"4",children:"4 KiÅŸi"}),(0,a.jsx)("option",{value:"5",children:"5+ KiÅŸi"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-posta (Ä°steÄŸe BaÄŸlÄ±)"}),(0,a.jsx)("input",{type:"email",value:b.email,onChange:e=>h({...b,email:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"ornek@email.com"})]})]})]}),f&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm",children:f}),!f&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Test iÃ§in:"}),(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-xs",children:["Sokak: ",(0,a.jsx)("strong",{children:"GÃ¼l SokaÄŸÄ±"})," â†’ Apartman:"," ",(0,a.jsx)("strong",{children:"YeÅŸil ApartmanÄ±"})," â†’ Daire: ",(0,a.jsx)("strong",{children:"3"})," ","â†’ Åifre: ",(0,a.jsx)("strong",{children:"daire3_yesilapt"}),(0,a.jsx)("br",{}),(0,a.jsx)("em",{children:"Yeni kayÄ±t olmak iÃ§in farklÄ± bir daire seÃ§in"})]})]})}),(0,a.jsx)("button",{onClick:A,disabled:x||!b.street||!b.building||!b.apartment_no||!b.password,className:"w-full py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center mt-4",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"login"===n?"GiriÅŸ YapÄ±lÄ±yor...":"KayÄ±t YapÄ±lÄ±yor..."]}):(0,a.jsx)(a.Fragment,{children:"login"===n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l,{className:"w-5 h-5 mr-2"}),"GiriÅŸ Yap"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i,{className:"w-5 h-5 mr-2"}),"KayÄ±t Ol"]})})}),(0,a.jsx)("div",{className:"mt-2 p-2 bg-gray-50 border border-gray-200 rounded text-xs text-gray-500",children:(0,a.jsxs)("div",{className:"font-mono truncate",children:["login"===n?"ğŸ” GiriÅŸ modu":"ğŸ“ KayÄ±t modu"," | Sokaklar: ",m.length," | Apartmanlar: ",g.length]})})]})]}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Hackathon Projesi | Eko-Akort Â© 2025"})})]})})}e.s(["default",()=>u],89954)}]);